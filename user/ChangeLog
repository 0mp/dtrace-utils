2011-04-13  Shujing Zhao  <pearly.zhao@oracle.com>

	Remove librtld.
	* makefile: Adjust.
	* libdtrace/dt_open.c, dt_proc.c: Fix.
	* libproc/common/Psymtab.c, Psymtab_machelf32.c: Fix. 

2011-04-06  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/dtrace.c: clear function prochandler.
	* include/sys/regset.h: Don't include privregs.h.
	* libdtrace/dt_proc.c: Remove to get infor from Ppsinfo.
	libproc/common
	* P32ton.c: Remove the functions about lwp.
	* Pcontrol.c: Remove the functions about lwp-specific operation.
	* Pservice.c: Likewise.
	* Pstack.c: Likewise.
	* Plwpregs.c: Delete.
	* proc_arg.c: Delete.
	* proc_get_info.c: Delete.
	* proc_names.c: Delete.
	* proc_set.c: Delete.
	* proc_stdio.c: Delete.
	* libproc.h: Delete.
	* makefile: Fixed.
	
2011-03-30  Shujing Zhao  <pearly.zhao@oracle.com>
	
	* include/sys/link.h: Include system link.h and remove the conflict
	definitions.
	* librtld/rd_elf.c, rtld.h: Fixed.

2011-03-30  Shujing Zhao  <pearly.zhao@oracle.com>

	Clean the header files.
	include/
	* confname_add.h, door.h, ieeefp.h, objfs.h, param.h, priv.h, procfs.h,
	  types_blk.h, types_boolean.h, types_dev.h, types_lmid.h, types_off.h,
	  types_pad.h, types_posix.h, types_time.h, zmod.h, zone.h, sys/fp.h,
	  sys/old_procfs.h: Removed and moved the useful definitions to
	types_various.h. Change the files that include these files.
	* sys/types.h: Added.
	* types_various.h: Added definitions. 
	
	cmd/
	* dtrace.c, makefile: Move to the parent directory.
	
	libproc/
	* common/Pgcore.c: Removed.
	* common/makefile: Fixed.

2011-03-29  Shujing Zhao  <pearly.zhao@oracle.com>

	Remove pr_*.c files from libpro/common/.
	* libproc/common/makefile: Remove the pr_*.o from libproc.
	* libproc/common/libproc.h: Remove the declarations for the functions
	  definied at pr_*.c files.
	* libdtrace/dt_pid.c: Don't use pr_open and pr_close.
	* libproc/common/Psyscall.c: Don't use pr_lwp_exit.
	* include/types_various.h: Clean the definitions.

	* libdtrace/makefile: Fix.

2011-03-22  Shujing Zhao  <pearly.zhao@oracle.com>

	Remove the support to i386 and only support amd64.
	* makefile: Use D_ILP64 instead of D_ILP32.
	* libproc: Remove i386 and add amd64.
	* driver/dis_tables.c, driver/dis_tables.h: Move to common/dis/.

2011-03-11  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/common/dtrace.c: Uncomment function dtrace_handle_proc.
	* include/types_various.h: Remove SIGCANCEL and SYS_forksys.
	* libdtrace/dt_proc.c (dt_proc_control): Trace SYS_fork instead of
	SYS_forksys. Use SIGUSR1 instead of SIGCANCEL. Use pthread_kill
	instead of _lwp_kill.
	(dt_proc_creat): Pass DT_PROC_STOP_IDLE to dt_proc_create_thread.
	* libport/time.c: Remove _lwp_kill.
	* runtest.sh: Update

2011-03-04  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Pcontrol.c: Comment the codes about write ctf file.
	Add ptrace code if needed.

2011-02-25  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/dt_impl.h (dt_module_t): Remove memeber dm_modid since
	there is no module id at Linux.
	* libdtrace/dtrace.h (dtrace_objinfo_t): Remove memeber dto_id.
	* libdtrace/dt_module.c, libdtrace/dt_open.c: Remove the reference to
	dm_modid and dto_id.
	* libdtrace/*, common/ctf/*, libproc/common/*: Remove inclusion header
	file sysmacros.h.
	* runtest.sh: Update.

2011-02-12  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/procfs.sed.in: Include the needed and existing header
	files.

2011-02-11  Shujing Zhao  <pearly.zhao@oracle.com>
	
	* libproc/common/Putil.c: Change dprintf to _dprintf.
	* libproc/common/Putil.h: Adjust.
	* libproc/common/Pcontrol.c, libproc/common/Pexecname.c,
	libproc/common/Psymtab_machelf32.c, libproc/common/Pzone.c,
	libproc/common/Pidle.c, libproc/common/pr_meminfo.c,
	libproc/common/Pscantext.c, common/Pstack.c, libproc/common/Psymtab.c,
	libproc/common/Pcore.c, libproc/common/Pservice.c: Adjust caller.

2011-02-10  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/common/dtrace.c: Assigned g_ofp to stdout in main function for
	stdout is a macro and not be address constants at compile time.
	* demo/*: Add more test cases.
	* runtest.sh: Added.
	* libdtrace/makefile: Adjust regs.d.
	* makefile: Adjust.

2011-01-26  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/makefile (signal.d): Exchange the line of SIGCLD and
	SIGCHLD, SIGPOLL and SIGIO.
	(install): Install errno.d regs.d signal.d unistd.d to the
	/usr/lib/dtrace.
	* libdtrace/i386/regs.sed.in: Remove @.

2011-01-21  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/dt_open.c: Fix the directory of _dtrace_defcpp.
	* libdtrace/io.sed.in, ip.sed.in, net.sed.in, procfs.sed.in,
	sysevent.sed.in, tcp.sed.in, udp.sed.in, i386/regs.sed.in: Remove the
	header files that are not existed.
	* libdtrace/makefile: Compile the D library and install to
	/usr/lib/dtrace.

2011-01-10  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Psymtab.c (get_saddrs): Initial addrs to NULL.

2011-01-07  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Psymtab.c (rd_loadobj_iter): Fix this function to get
	the right data of the library.

2010-12-24  Shujing Zhao  <pearly.zhao@oracle.com>

	* librtld/rtld_db.c: Move rd_loadobj_iter to ...
	* libproc/common/Psymtab.c: here and remove the first parameter rap
	and adjust the callers.
	* include/rtld_db.h (rd_loadobj_iter): Remove.
	* libproc/common/Pcontrol.h (rd_loadobj_iter): Declare.

2010-12-17  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/common/dtrace.c: set environment variable POSIXLY_CORRECT to
	make getopt works on Linux.

2010-12-07  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/dt_proc.c (dt_proc_control): Set dpr->dpr_quit to 1
	instead of write ctl file.
	* libproc/common/Pcontrol.c (Pxcreate): Don't detach to the child
	process.
	(Psetrun): Restarts the stopped child process by ptrace instead of
	write to the ctl file.
	* libproc/common/Psymtab.c (Pupdate_maps): Use fclose instead of close
	to close the file.

2010-12-03  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/sys/procfs.h: Comment the definition of prxmap_t and
	prxmap32_t. They are not be used.
	* libproc/common/Pcontrol.c (Pxcreate): Use ptrace to trace child
	process instead of using signal to control it.
	* libproc/common/Psymtab.c (Pupdate_maps): Change the way to read
	/proc/<pid>/maps, for the file size is zero at Linux.
	* libproc/common/Psymtab.c (Preadauxvec): Change the way to read
	/proc/<pid>/auxv, for the file size is zero at Linux.

	* libproc/common/Pscantext.c (Pscantext): Change the way to read
	/proc/<pid>/maps.

2010-11-24  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Pcontrol.c (sig_int): New function used as signal
	handler.
	(Pxcreate): Add signal handler to child process. Use
	/proc/<pid>/mem instead of /proc/<pid>/as, </proc/<pid>/stat instead
	of /proc/<pid>/status and remove to use /proc/<pid>/ctl. Use waitpid
	on the parent process.
	(Pgrab, Preopen, Pstopstatus): Similar with the Pxcreat. Fix the proc
	files and don't use ctl to control the process.

2010-11-16  Shujing Zhao  <pearly.zhao@oracle.com>
	
	* libdtrace/makefile (dt_lex.c): Use "-l" compatibility option to write
	  to the .c file.
	* libdtrace/dt_impl.h: Remove the declaration of yytext for Linux.
	* libdtrace/dt_lex.l: Undefine input() and unput() and define YY_INPUT()
	  macro.

2010-11-05  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/makefile (dt_errtags.c, dt_names.c): Use sh to run the
	script.

2010-11-04  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/types_various.h (SYS_getpeername, SYS_getsockname and
	SYS_getsockopt): New.
	* include/sys/old_procfs.h: Make old_procfs.h can be included even
	_LP64 is not defined.
	* libdtrace/dt_module.c: Use elf_getshstrndx instead of
	elf_getshdrstrndx.
	* libport/elf.c: Removed.
	* libport/makefile: Remove elf.o and fix the compile option.
	* libproc/common/Psymtab.c: Use elf_getshstrndx and elf_getshnum
	instead of elf_getshdrstrndx and elf_getshdrnum.

2010-11-03  Shujing Zhao  <pearly.zhao@oracle.com>

	* common/ctf/ctf_create.c: Include types_various.h.
	
	include/
	* ieeefp.h: New.
	* sys/fp.h: New.
	* sys/procfs.h: New.
	* sys/signal2.h: New.
	* sys/types32.h: New.
	* procfs.h: Remove _STRUCTURED_PROC definition.
	* types_posix.h: New type major_t and minor_t.
	* types_time.h: New struct itimerval32.
	* procfs_service.h: Move psaddr_t and lwpid_t to ...
	* types_various.h: ... here.
	(dev32_t, size32_t and caddr32_t): Removed.
	(ino64_t): Define if ino64_t not defined.
	(blkcnt64_t and blksize_t): New type.
	(SYS_sigaction and SYS_fstatat64): New.
	(SYS_getpeername, SYS_getsockname and SYS_getsockopt): Removed.
	(flock64_32_t): New.
	(SI_FROMUSER, SI_FROMKERNEL and SI_CANQUEUE): New.
	* sys/auxv.h: Remove _ASM and _SYSCALL32 conditional.
	* sys/link.h: Likewise. 
	* sys/old_procfs.h: Likewise.
	* sys/procfs_isa.h: Likewise.
	* sys/regset.h: Likewise.
	* sys/stat.h: Likewise.
	* sys/statvfs.h: New type statvfs32_t.

	libdtrace/
	* dt_aggregate.c: Include sys/procfs.h.
	* dt_module.c: Include sys/stat.h.
	* makefile (dt_module.o): Use -D_LARGEFILE64_SOURCE=1 option.

	libproc/common/
	* P32ton.c (sigaction_32_to_n, sigaction_n_to_32): Use sa_handler32.
	(siginfo_32_to_n, siginfo_n_to32): Remove the lines of asign to the
	members that don't exist on Linux.
	(prfpregset_32_to_n, prfpregset_n_to_32): Comment the part of amd64.
	* P32ton.h: Fix the inclusions.
	* Pcore.c (core_find_text, core_find_data): Convert the type.
	* Psyscall.c: Include sys/stack.h.
	* makefile: Add compile option -I../../uts/intel/
	(Pcore.o): Add -D_LARGEFILE64_SOURCE=1 option.
	* pr_getitimer.c: Include types_time.h.
	* pr_stat.c: Remove the lines of st_fstype.
	* pr_statvfs.c: Remove the lines of f_basetype and f_fstr.
	
	libport/
	* elf.c: New
	* makefile: Update.

	librtld/
	* rtld.h: Remove _SYSCALL32 conditional.
	* rtld_db.c: Define _rd_reset64.

	uts/common/
	* sys/ctf_api.h: Include sys/procfs.h.
	* sys/procfs.h: Removed.
	* intel/sys/stack.h: New.
	* intel/ia32/sys/stack.h: New.

2010-10-26  Shujing Zhao  <pearly.zhao@oracle.com>
	
	* libdtrace/makefile: Fix dt_isadep.o, dt_module.o.
	* libdtrace/dt_module.c: Include sys/stat.h.

2010-10-25  Paolo Carlini  <paolo.carlini@oracle.com>

	* libdtrace/drti.c (dprintf): Remove.

2010-10-25  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/dt_grammar.c: Remove generated file.
	* libdtrace/makefile: Fix BUILD_DIR.
	* libport/makefile: Same.
	* libproc/common/makefile: Same.

2010-10-22  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/dtrace.c: Remove.
	* uts/common/sys/elftypes.h: Remove.
	* include/sys/int_types.h: Remove int_fast16_t etc.
	* include/sys/regset.h: Remove gregset_t delaration.

2010-10-21  Shujing Zhao  <pearly.zhao@oracle.com>

	* demo/act/time.d: New.
	* makefile: New.
	* libproc/common/makefile: Fix BUILD_DIR.
	* cmd/common/makefile: Same.
	* libctf/makefile: Same.
	* libdtrace/makefile: Same.
	* libport/makefile: Same.
	* librtld/makefile: Same.

2010-10-15  Shujing Zhao  <pearly.zhao@oracle.com>

	* librtld/rtld_db.c: Comment some functions.
	* cmd/common/makefile: New.
	* include/mutex.h: Declare mutex_init.
	* include/procs_service.h: include elf.h.
	* include/rtld_db.h: Update declaration.
	* include/type_posix.h: Define off64_t.
	* libdtrace/dt_cc.c: Define yylineno.
	* libdtrace/dt_lex.l: Define unput.
	* libdtrace/makefile: Fix compile option.
	* libport/proc_name.c: Define fork1.
	* libport/time.c: Define pthread_cond_reltimedwait_np, mutex_init and
	_lwp_kill.
	* libproc/common/makefile: Fix.
	* libproc/common/Pcontrol.c, libproc/common/Pexecname.c,
	libproc/common/Pzone.c: Comment some lines that are not supported by
	Linux.

2010-09-27  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/rtld_db.h, include/types_off.h: Adjust definition.
	* libctf/makefile: Use /usr/bin/gcc.
	* libport/makefile, libport/p_online.c, libport/tasksys.c: New.
	* libproc/common/makefile: Use -D_LARGEFILE64_SOURCE=1 to make the
	off64_t available.
	* libproc/common/Pzone.c: Comment some functions not be compiled.
	* librtld/rd_elf.c: New.
	* librtld/makefile: Add rd_elf.o to LIB.
	* librtld/rtld_db.c (rd_loadobj_iter, rd_event_addr, rd_event_enable,
	rd_event_getmsg): Change.
	(rd_plt_resolution, rd_objpad_enable): Remove.

2010-09-21  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/objfs.h: Move to uts/common/sys/.
	* libdtrace/makefile: Export correct format to dt_errtags.c.
	* libdtrace/dt_impl.h, dt_open.c, dt_parser.c, dt_dof.c: Fixed include
	header files.
	* librtld/makefile: Fix the compile options.
	* include/types_various.h: Add ABS macro and and move OBJFS_ROOT to
	objfs.h.

2010-09-19  Shujing Zhao  <pearly.zhao@oracle.com>

	* driver/dis_tables.h: Include sys/int_types.h.
	* driver/dis_tables.c: Added.
	* libdtrace/mknames.sh: Use awk. 
	* libdtrace/makefile: Include dis_tables.o, dt_errtags.o and
	dt_names.o.

2010-09-17  Shujing Zhao  <pearly.zhao@oracle.com>

	* libport/gmatch.c: Added.
	* librtld/makefile, libctf/makefile: Added.
	* include/types_various.h, include/types_off.h: Update.

2010-09-16  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/mutex.h, libdtrace, libproc, librtld: Fix the mutex
	problems.
	* libport/proc_name.c, libport/strlcat.c: Added.
	* include/port.h, uts/common/sys/mnttab.h, include/sys/bitmap.h,
	include/sys/elftypes.h: Added.

2010-09-13  Shujing Zhao  <pearly.zhao@oracle.com>

	* librtld: Added.
	* libdtrace (dt_lex.l, makefile): Fixed.
	* include/types_various.h: Define ino64_t and PS_OBJ_LDSO.

2010-09-10  Shujing Zhao  <pearly.zhao@oracle.com>

	* libport: Add compat functions support at libport.
	* libdtrace/makefile: Handle the dt_lex.l and add it to the lib.
	* libdtrace/dt_impl.h: Define different yytext at Linux.

2010-09-08  Shujing Zhao  <pearly.zhao@oracle.com>

	* Define __USE_ATFILE before include <fcntl.h> when use AT_*
	constants.
	* Add makefile for libproc and libdtrace.
	* Adjust the header files.

2010-09-07  Shujing Zhao  <pearly.zhao@oracle.com>

	* Adjust the header files at directory include to make the files of
	libproc	can be compiled. Move some modified headers from uts to
	include. Fix the source files at libproc.

2010-08-31  Shujing Zhao  <pearly.zhao@oracle.com>

	* Strip the Solaris header files dependency from the sources files.
	Add the fix includes at the directory include. Fix the compile
	options.
