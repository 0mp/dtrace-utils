2011-05-31  Shujing Zhao  <pearly.zhao@oracle.com>

	* makefile: Use -D_GNU_SOURCE and clean CC.
	* cmd/makefile: Clean CPPFLAGS.
	* libctf/makefile: Likewise.
	* libdtrace/makefile: Likewise. 
	* libproc/common/makefile: Likewise.
	* libdtrace/dt_string.c: Remove strndup.
	* libdtrace/dt_string.h: Likewise.
	* include/types_various.h: Remove Lmid_t.

	* include/sys/regset.h: Remove the definitions of register.
	* libdtrace/i386/regs.sed.in: Rewrite according to the definitions at
	reg.h.
	* libdtrace/i386/regs.d.in: Rewrite. 

	* runtest.sh: Downward compatibility case statement.

2011-05-25  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/makefile (dt_lex.c): Fix -o option of flex.

2011-05-25  Nick Alcock  <nick.alcock@oracle.com>

	Remove references to zones.

	* uts/common/sys/dtrace.h: ... from here...
	* include/sys/corectl.h: ... and here...
	* include/sys/procfs.h: ... and here...
	* include/types_various.h: ... and here...
	* libdtrace/dt_open.c: ... and here...
	* libproc/common/Pcontrol.c (Pfree): ... and here...
	* libproc/common/Pcontrol.h: ... and here...
	* libproc/common/Psymtab.c: ... and here.
	* libproc/common/Pzone.c: Removed...
	* libproc/common/makefile: ... and from here.
	* libproc/common/Psymtab.c (Pfindmap): Migrated from
	Pzone.c, with zone support removed.

	Remove some references to <sys/procfs.h>.

	* include/procfs_service.h: Remove inclusion.
	* libdtrace/dt_aggregate.c: Likewise.
	* libdtrace/procfs.sed.in: Likewise.
	* libproc/common/Pcontrol.h: Likewise.

	Remove process set functions.

	* libproc/common/Putil.c (prset_fill): Remove.
	(prset_empty): Likewise.
	(prset_add): Likewise.
	(prset_del): Likewise.
	(prset_ismember): Likewise.
	* libproc/common/Putil.h: Remove declarations.

	Remove fault trapping.

	* libdtrace/dt_proc.c (dt_proc_control): Removed.
	* libproc/common/Pcontrol.c (Pfault): Likewise.
	(Psetfault): Likewise.
	(Psetaction): Likewise.
	(Psync): Remove SETFAULT.
	(restore_tracing_flags): Likewise.
	libproc/common/Pcontrol.h: Likewise.

	Fix environment handling.

	* libproc/common/Psymtab.c (Plookup_by_name): Remove.
	(NARG): Remove.
	(Penv_iter): Get the environment the Linux way. Read in the whole
	thing, then process it, rather than working chunk-by-chunk.
	(getenv_func): Drop the address-of-environment arg.

	Compensate for new ioctls.

	* libdtrace/dt_subr.c (dt_ioctl): Use the Linux definition of
	'val'.
	* libdtrace/dt_impl.h: Adjust declaration.

	Cleanup.

	* libproc/common/libproc.h: Remove declarations of deleted
	functions.
	* libproc/common/mapfile-vers: Likewise.

2011-05-24  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/makefile (dt_lex.o): Pass -DYYDEBUG=1.

2011-05-23  Kris Van Hees  <kris.van.hees@oracle.com>

	* uts/common/sys/dtrace_ioctl.h: New file - needed for correct
	ioctl IDs.
	* uts/common/sys/dtrace.h: Removed ioctl IDs, replaced with an
	include of dtrace_ioctl.h.

2011-05-23  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/dt_grammar.y (%): Prototype yylex().
	* libdtrace/dt_impl.h (yytext): Make it a pointer, to allow flex
	to parse tokens of unbounded length efficiently.
	* libdtrace/makefile (dt_lex.c): No longer run flex in traditional
	mode. Use -o rather than redirecting output.
	* libdtrace/dt_lex.l: Turn on automatic yylineno updating.
	Push the ^ in RGX_INTERP and RGX_CTL into the rules where they are
	expanded, as POSIX mode wraps all variable expansions in (), and ^
	is not meaningful inside ().
	Fix dangerous trailing context: this has no meaningful
	semantics and is undefined per POSIX.

	* demo/dtrace/end.d: Test skipping of interpreter lines. (This
	is the only rule modified above which does not yield an error
	if matched.)

2011-05-23  Nick Alcock  <nick.alcock@oracle.com>

	* runtest.sh: Support regression tests via multiple dtrace build
	directories. Use case rather than if/elif tree, and echo rather
	than if. Post-process regtest output to conceal variable pointer
	addresses.

	* libdtrace/dt_dis.c (dt_dis): Print pointers via %p, not 0x%p:
	%p under glibc, as on most systems, already includes an 0x.

	* .gitignore: New.

2011-05-23  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/dt_open.c (_dtrace_libdir): Use #define to decide value.
	* libdtrace/makefile (CPPFLAGS): Set it.

	* libdtrace/makefile (LIB): drti.o is not part of libdtrace.a...
	* libdtrace/makefile (DRTI_OBJ): ... but is independent, and goes
	in the build dir, like the library.
	* libdtrace/makefile (all): Build it.
	* libdtrace/drti-vers: New version script, for use by `dtrace -G'.
	* libdtrace/makefile (install): Install it. Use mkdir -p.

	* libdtrace/dt_link.c (dtrace_program_link): Link using drti-vers
	as a version script to enforce locality. Don't use the 64/
	subdirectory.

2011-05-23 Shujing Zhao  <pearly.zhao@oracle.com>

	* libport/proc_name.c: Remove.
	* libport/makefile: Remove proc_name.o from the lib.
	* include/port.h: Clean the declaration.
	* libproc/common/libproc.h: Clean the declarations that have been
	removed the definitions.

2011-05-20  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/drti.c: Remove needless back-compatibility.
	* libdtrace/drti.c (dtrace_dof_init): Likewise.

2011-05-18  Nick Alcock  <nick.alcock@oracle.com>

	* makefile: Turn on warnings. Move to LARGEFILE64 mode,
	providing open64() et al.

 	* libproc/common/Pcontrol.c (prdump): Cure aliasing violation.
	(restore_tracing_flags): Drop unused variable.
	(Pxcreate): Likewise. Use fork(), not fork1().
	* libdtrace/dt_cc.c (dt_preproc): Likewise.
	(dt_compile): Make sure rv is always initialized.
	* libport/proc_name.c: Drop fork1().

	* include/port.h: Fix lethal typo. Import many more declarations.

	* libdtrace/dt_cc.c: Include <port.h>.
	* libdtrace/dt_aggregate.c: Likewise.
	* libdtrace/dt_consume.c: Likewise.
	* libdtrace/dt_pid.c: Likewise.
	* libdtrace/dt_printf.c: Likewise.
	* libdtrace/dt_provider.c: Likewise.
	* libdtrace/dt_work.c: Likewise.
	* cmd/dtrace.c: Likewise.
	* libproc/common/Psymtab.c: Likewise.
	* libproc/common/Pzone.c: Likewise.
	* libdtrace/dt_module.c: Likewise. Also use <string.h>, not the
	obsolete <strings.h>. Drop some commented-out headers.
	* libdtrace/dt_proc.c: Include <port.h> and <poll.h>.
	* libdtrace/dt_subr.c: Include <port.h> and <sys/ioctl.h>.

	* libdtrace/dt_open.c (dt_get_sysinfo): Remove.
	(dt_vopen): Drop nonportable sysinfo(), use uname() instead.
	* libproc/common/Psymtab.c (Pplatform): Likewise.
	* include/sys/auxv.h: Drop nonportable sysinfo().
	* include/sys/elf.h (NT_PLATFORM): Likewise.
	* include/types_various.h: Likewise.

	* common/dis/dis_tables.c (dtrace_disx86): Add explicit brackets.
	* libdtrace/dt_aggregate.c (dtrace_aggregate_snap): Likewise.
	* libdtrace/dt_aggregate.c (dt_aggregate_valcmp): Note possible
	site of crash (not fixed).
	* libdtrace/dt_options.c (dt_options_load): Likewise.

	* include/sys/compiler.h (_dt_noreturn_): New.
	* libdtrace/dt_parser.c (dnerror): Use it.
	(xyerror): Likewise.
	(yyerror): Likewise.
	* libdtrace/dt_parser.h: Likewise.

	* libdtrace/i386/dt_isadep.c: Include missing header.
	* libdtrace/drti.c: Likewise.
	(dtrace_dof_init): Cast pointer. Avoid possible uninitialized
	variable use.
	* libdtrace/dt_consume.c (dt_print_stack): Cast uint64_t
	to 'unsigned long long' as its size can vary.
	* libdtrace/dt_handle.c (dt_handle_cpudrop): Likewise.
	(dt_handle_status): Likewise.
	* libdtrace/dt_subr.c (dtrace_uaddr2str): Likewise.
	* libdtrace/i386/dt_isadep.c (dt_pid_create_glob_offset_probes):
	Cast value sprintf()ed with %x to 'int'.
	* libproc/common/Psymtab.c (Pupdate_maps): 'inode' is an unsigned
	type. fopen() returns NULL on failure, not a value < 0.

	* libdtrace/dt_handle.c (dt_handle_liberr): Assign '0' to numeric
	types, not NULL.
	* libdtrace/dt_module.c (dt_module_unload): Likewise.
	* libproc/common/Psymtab_machelf32.c (fake_elf64): Likewise.
	Avoid uninitialized data accesses due to #if 0'ed branch.

	* libproc/common/Psymtab.c (rd_loadobj_iter): Remove unused variable.
	Note possible pointer size bug (not fixed).

	* libport/time.c (gethrtime): Use new-style definition.

2011-05-18  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/dt_proc.c: Remove dt_proc_bpcreate from Linux.
	(dt_proc_bpenable): It can set bkpt by Psetbkpt. Remove it.
	* libproc/common/Pcontrol.c (restore_tracing_flags): Remove the part
	of writing ctl file.
	(Pclearsig): Remove.
	(Pclearfault): Remove.
	(Psetbkpt): Remove.
	(execute_bkpt): Remove.
	(Pxecbkpt): Remove.
	(Psetwapt): Remove.
	(Pdelwapt): Remove.
	(execute_wapt): Remove.
	(Pxecwapt): Remove.
	(Psignal): Remove.
	(Padd_mapping): Remove.
	(map_sort): Remove.
	(Psort_mappings): Remove.
	* libproc/common/libproc.h: Clear declarations.
	* libproc/common/Pcontrol.h: Clear.

2011-05-17  Nick Alcock  <nick.alcock@oracle.com>

	* libdtrace/makefile: Create most .d files with one pattern rule.
	No longer create .sed.in.c files. Clean up properly.

2011-05-16  Nick Alcock  <nick.alcock@oracle.com>

	* libctf/ctf_lib.c: Include missing header.
	* libctf/ctf_subr.c: Likewise.
	* common/ctf/ctf_types.c: Likewise.
	* common/ctf/ctf_labels.c: Likewise.

	* common/ctf/ctf_labels.c (ctf_label_topmost): Convince GCC that
	these variables are initialized when used.
	* common/ctf/ctf_labels.c (ctf_label_iter): Likewise.

	* common/ctf/ctf_create.c (ctf_discard): Do not assign to
	uninitialized variables or infloop when skipping committed types.

2011-05-13  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Psymtab.c (Pbuild_file_symtab): Replace
	/proc//object/a.out with /proc//exe.
	* libproc/common/Pzone.c (Pfindmap): Replace /proc//path/a.out with
	/proc//exe.
	(Pbrandname): Remove.
	* libproc/common/makefile: Remove Pcore.o.

2011-05-12  Nick Alcock  <nick.alcock@oracle.com>

	Purge zlib indirection machinery.

	* libctf/ctf_lib.c (_libctf_zlib): Remove.
	(struct zlib): Likewise.
	(_libctf_init): Drop its initialization, and LIBCTF_DECOMPRESSOR.
	Make static.
	(ctf_zopen): Remove.
	(z_uncompress): Likewise.
	(z_strerror): Likewise.

	* common/ctf/ctf_impl.h: Remove from header.
	(ECTF_ZMISSING): Remove.
	(ECTF_ZINIT): Likewise.

	* common/ctf/ctf_open.c: Include zlib.h.
	* common/ctf/ctf_open.c (ctf_bufopen): Call the zlib functions
	directly.

2011-05-12  Nick Alcock  <nick.alcock@oracle.com>

	Translate PRINTFLIKE into GCC attributes.

	* include/sys/compiler.h: Don't bother with individual ifdef guards.
	* include/sys/compiler.h (_dt_printflike_): New.
	* include/sys/compiler.h (_dt_unused_): Likewise.

	* libdtrace/dt_link.c (dt_link_error): Use _dt_printflike_().
	* libdtrace/dt_parser.c (dnerror): Likewise.
	(dnwarn): Likewise.
	(xyerror): Likewise.
	(xywarn): Likewise.
	(yyerror): Likewise.
	(yywarn): Likewise.
	* libdtrace/dt_proc.c (dt_proc_error): Likewise.
	* libdtrace/dt_subr.c (dt_dprintf): Likewise.
	(dt_printf): Likewise.

	* libctf/ctf_subr.c (ctf_dprintf): Likewise.
	* common/ctf/ctf_decl.c (ctf_decl_sprintf): Likewise.

	* cmd/dtrace.c: Include <sys/compiler.h>.
	(fatal): Use _dt_printflike_().
	(dfatal): Likewise.
	(error): Likewise.
	(notice): Likewise.
	(oprintf): Likewise.

	* libproc/common/Putil.c (_dprintf): Likewise.
	(Perror_printf): Likewise. Also use _dt_unused_.

	* libdtrace/dt_impl.h: Add to prototypes too.
	* libdtrace/dt_parser.h: Likewise. Include <sys/compiler.h>.
	* common/ctf/ctf_impl.h: Likewise. Include <sys/compiler.h>.
	* libproc/common/libproc.h: Likewise.
	* libproc/common/Putil.h: Reintroduce elided _dprintf()
	declaration. Include <sys/compiler.h>.

	* libproc/common/Pcontrol.c (Psetrun): Use _dprintf().

2011-05-12  Nick Alcock  <nick.alcock@oracle.com>

	Begin transforming pragmas to GCC attributes.

	* include/sys/compiler.h: New file, defining
	_dt_constructor_ and _dt_destructor_.

	* libdtrace/drti.c: Include <sys/compiler.h>.
	* libdtrace/dt_impl.h: Likewise. Drop commented-
	out include.
	* libctf/ctf_lib.c: Likewise.
	* libproc/common/libproc.h: Likewise.
	* libproc/common/Pcontrol.h: Likewise.

	* libproc/common/Pcontrol.c (_libproc_init):
	Declare using _dt_constructor_.
	* libctf/ctf_lib.c (_libctf_init): Likewise.
	* libdtrace/dt_open.c (_dtrace_init): Likewise.
	* libdtrace/drti.c (dtrace_dof_init): Likewise.
	* libdtrace/drti.c (dtrace_dof_fini): Declare using
	_dt_destructor_.

	* libdtrace/dt_proc.h: Drop commented-out include.

2011-05-12  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/P32ton.c, P32ton.h: Remove.
	* libproc/common/Pcontrol.c: Clean headers.
	* libproc/common/makefile: Remove P32ton.o from libproc.

2011-05-11  Shujing Zhao  <pearly.zhao@oracle.com>
	
	* libdtrace/dt_module.c (dtrace_update): Don't open the /system/object
	files.
	(dt_module_update): Remove.
	* include/sys/link.h: Clean the useless macros.
	* uts/common/sys/ctfs.h: Remove CTFS_ROOT.
	* uts/common/sys/objfs.h: Remove OBJFS_ROOT and OBJFS_MODID.

2011-05-09  Nick Alcock  <nick.alcock@oracle.com>

	* libproc/common/Psymtab.c (Penv_iter): Remove bogus check on length of
	argument lists: recent Linux kernels have no limit, and programs should
	never assume a limit.
	* libdtrace/procfs.sed.in: Remove nonexistent headers.

2011-05-06  Nick Alcock  <nick.alcock@oracle.com>

	* makefile (MACH): Use 'uname -m' to get machine arch.
	* makefile (archcheck): Grammar fix.

2011-05-05  Nick Alcock  <nick.alcock@oracle.com>

	Remove syscall interposition.

	* libproc/common/Pcontrol.c: Clean headers.
	* libproc/common/Pcontrol.c (Pxcreate): No longer use pause() and syscall
	interposition to trace after execvp(). Drop lots of commented-out code.
	* libproc/common/Pcontrol.c (Pcreate_callback): Removed.
	* libproc/common/Pcontrol.c (Psync): Delete SETENTRY and SETEXIT cases.
	* libproc/common/Pcontrol.c (restore_tracing_flags): Likewise.
	* libproc/common/Pcontrol.c (Pstopstatus): Likewise.
	* libproc/common/Pcontrol.c (Psysentry): Remove.
	* libproc/common/Pcontrol.c (Psetsysentry): Likewise.
	* libproc/common/Pcontrol.c (Psysexit): Likewise.
	* libproc/common/Pcontrol.c (Psetsysexit): Likewise.
	* libproc/common/libproc.h ("C"): Remove Psysentry and Psysexit.
	* libproc/common/P32ton.c (pstatus_n_to_32): Remove pr_sysentry and
	pr_sysexit.
	* libproc/common/mapfile-vers: Remove now-deleted functions.

	* include/sys/procfs.h: Remove PCSENTRY, PCSEXIT, pr_sysentry
	and pr_sysexit.

	* libdtrace/dt_proc.c (IS_SYS_EXEC): Remove.
	* libdtrace/dt_proc.c (IS_SYS_FORK): Likewise.
	* libdtrace/dt_proc.c (dt_proc_rdwatch): Likewise.
	* libdtrace/dt_proc.c (dt_proc_attach): Remove rtld tracing pending
	addition of appropriate static tracepoints.
	* libdtrace/dt_proc.c (dt_proc_control): Remove syscall hooking of
	fork(), vfork(), and forksys(), and detachment/reattachment and
	breakpoint manipulation around fork().

2011-04-29  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Pcore.c, Pexecname.c, Pisadep.h, Pservice.c,
	Pstack.c, Pstack.h: Removed.
	* libproc/common/makefile: Remove Pcore.o, Pexecname.o, Pservice and
	Pstack.o.
	* libproc/common/Pzone.c (Pfindmap): Don't handle a.out segment.
	* libproc/common/Pcontrol.c (Psetrun): Pass the sig argument to ptrace.
	* libproc/amd64/Pisadep.c: Remove the functions that would never be
	called.

2011-04-28  Shujing Zhao  <pearly.zhao@oracle.com>

	* runtest.sh: Test "-p" option by grab self pid.
	* libproc/amd64/Pisadep.c: Remove Psyscall_copyinarg and
	Psyscall_copyoutargs.
	* libproc/common/Pisadep.h: Same.
	* libproc/common/Pcontrol.c: Don't use statfd to get the proc status
	  information.
	  (deadcheck, Pgetareg, Pputareg read_lfile): Remove.
	  (Pgrab): Rewrite it by using ptrace.
	  (Pxcreate): statfd is always be set to -1. Don't open or read any /proc
	  files.
	  (Preopen): Same. Also clean the codes of pr_lwp.
	  (Pfree): Clean the codes since some fds would never be set.
	  (Prelease): Clean the codes of pr_lwp.
	  (Psetrun, Psetflags, Punsetflags): Same.
	  (Pstopstatus): Clean the codes about statfd.

2011-04-22  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/rtld_db.h: Clean.
	* libproc/common/Pzone.c: Remove the functions that handle LOFS.	

2011-04-19  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/dtrace.c: Don't include libproc.h.
	* makefile: Fix.
	* libdtrace/dt_proc.c: Rmove dt_proc_bpmatch.
	* libproc/common/Pcore.c: Remove note_lwpstatus, note_lwpsinfo and
	  lwpid2info.
	* libproc/common/Pcontrol.c: Remove the part about agentcnt.
	* libproc/common/Pidle.c, Pscantext.c, Psyscall.c: Removed.
	* libproc/common/makefile: Fix.
	* uts/common/sys/ccompile.h, time_std_impl.h: Removed.

2011-04-13  Shujing Zhao  <pearly.zhao@oracle.com>

	Remove librtld.
	* makefile: Adjust.
	* libdtrace/dt_open.c, dt_proc.c: Fix.
	* libproc/common/Psymtab.c, Psymtab_machelf32.c: Fix. 

2011-04-06  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/dtrace.c: clear function prochandler.
	* include/sys/regset.h: Don't include privregs.h.
	* libdtrace/dt_proc.c: Remove to get infor from Ppsinfo.
	libproc/common
	* P32ton.c: Remove the functions about lwp.
	* Pcontrol.c: Remove the functions about lwp-specific operation.
	* Pservice.c: Likewise.
	* Pstack.c: Likewise.
	* Plwpregs.c: Delete.
	* proc_arg.c: Delete.
	* proc_get_info.c: Delete.
	* proc_names.c: Delete.
	* proc_set.c: Delete.
	* proc_stdio.c: Delete.
	* libproc.h: Delete.
	* makefile: Fixed.
	
2011-03-30  Shujing Zhao  <pearly.zhao@oracle.com>
	
	* include/sys/link.h: Include system link.h and remove the conflict
	definitions.
	* librtld/rd_elf.c, rtld.h: Fixed.

2011-03-30  Shujing Zhao  <pearly.zhao@oracle.com>

	Clean the header files.
	include/
	* confname_add.h, door.h, ieeefp.h, objfs.h, param.h, priv.h, procfs.h,
	  types_blk.h, types_boolean.h, types_dev.h, types_lmid.h, types_off.h,
	  types_pad.h, types_posix.h, types_time.h, zmod.h, zone.h, sys/fp.h,
	  sys/old_procfs.h: Removed and moved the useful definitions to
	types_various.h. Change the files that include these files.
	* sys/types.h: Added.
	* types_various.h: Added definitions. 
	
	cmd/
	* dtrace.c, makefile: Move to the parent directory.
	
	libproc/
	* common/Pgcore.c: Removed.
	* common/makefile: Fixed.

2011-03-29  Shujing Zhao  <pearly.zhao@oracle.com>

	Remove pr_*.c files from libpro/common/.
	* libproc/common/makefile: Remove the pr_*.o from libproc.
	* libproc/common/libproc.h: Remove the declarations for the functions
	  definied at pr_*.c files.
	* libdtrace/dt_pid.c: Don't use pr_open and pr_close.
	* libproc/common/Psyscall.c: Don't use pr_lwp_exit.
	* include/types_various.h: Clean the definitions.

	* libdtrace/makefile: Fix.

2011-03-22  Shujing Zhao  <pearly.zhao@oracle.com>

	Remove the support to i386 and only support amd64.
	* makefile: Use D_ILP64 instead of D_ILP32.
	* libproc: Remove i386 and add amd64.
	* driver/dis_tables.c, driver/dis_tables.h: Move to common/dis/.

2011-03-11  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/common/dtrace.c: Uncomment function dtrace_handle_proc.
	* include/types_various.h: Remove SIGCANCEL and SYS_forksys.
	* libdtrace/dt_proc.c (dt_proc_control): Trace SYS_fork instead of
	SYS_forksys. Use SIGUSR1 instead of SIGCANCEL. Use pthread_kill
	instead of _lwp_kill.
	(dt_proc_creat): Pass DT_PROC_STOP_IDLE to dt_proc_create_thread.
	* libport/time.c: Remove _lwp_kill.
	* runtest.sh: Update

2011-03-04  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Pcontrol.c: Comment the code about writing a ctf file.
	Add ptrace code if needed.

2011-02-25  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/dt_impl.h (dt_module_t): Remove memeber dm_modid since
	there is no module id at Linux.
	* libdtrace/dtrace.h (dtrace_objinfo_t): Remove memeber dto_id.
	* libdtrace/dt_module.c, libdtrace/dt_open.c: Remove the reference to
	dm_modid and dto_id.
	* libdtrace/*, common/ctf/*, libproc/common/*: Remove inclusion header
	file sysmacros.h.
	* runtest.sh: Update.

2011-02-12  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/procfs.sed.in: Include the needed and existing header
	files.

2011-02-11  Shujing Zhao  <pearly.zhao@oracle.com>
	
	* libproc/common/Putil.c: Change dprintf to _dprintf.
	* libproc/common/Putil.h: Adjust.
	* libproc/common/Pcontrol.c, libproc/common/Pexecname.c,
	libproc/common/Psymtab_machelf32.c, libproc/common/Pzone.c,
	libproc/common/Pidle.c, libproc/common/pr_meminfo.c,
	libproc/common/Pscantext.c, common/Pstack.c, libproc/common/Psymtab.c,
	libproc/common/Pcore.c, libproc/common/Pservice.c: Adjust caller.

2011-02-10  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/common/dtrace.c: Assigned g_ofp to stdout in main function for
	stdout is a macro and not be address constants at compile time.
	* demo/*: Add more test cases.
	* runtest.sh: Added.
	* libdtrace/makefile: Adjust regs.d.
	* makefile: Adjust.

2011-01-26  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/makefile (signal.d): Exchange the line of SIGCLD and
	SIGCHLD, SIGPOLL and SIGIO.
	(install): Install errno.d regs.d signal.d unistd.d to the
	/usr/lib/dtrace.
	* libdtrace/i386/regs.sed.in: Remove @.

2011-01-21  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/dt_open.c: Fix the directory of _dtrace_defcpp.
	* libdtrace/io.sed.in, ip.sed.in, net.sed.in, procfs.sed.in,
	sysevent.sed.in, tcp.sed.in, udp.sed.in, i386/regs.sed.in: Remove the
	header files that are not existed.
	* libdtrace/makefile: Compile the D library and install to
	/usr/lib/dtrace.

2011-01-10  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Psymtab.c (get_saddrs): Initial addrs to NULL.

2011-01-07  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Psymtab.c (rd_loadobj_iter): Fix this function to get
	the right data of the library.

2010-12-24  Shujing Zhao  <pearly.zhao@oracle.com>

	* librtld/rtld_db.c: Move rd_loadobj_iter to ...
	* libproc/common/Psymtab.c: here and remove the first parameter rap
	and adjust the callers.
	* include/rtld_db.h (rd_loadobj_iter): Remove.
	* libproc/common/Pcontrol.h (rd_loadobj_iter): Declare.

2010-12-17  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/common/dtrace.c: set environment variable POSIXLY_CORRECT to
	make getopt works on Linux.

2010-12-07  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/dt_proc.c (dt_proc_control): Set dpr->dpr_quit to 1
	instead of write ctl file.
	* libproc/common/Pcontrol.c (Pxcreate): Don't detach to the child
	process.
	(Psetrun): Restarts the stopped child process by ptrace instead of
	write to the ctl file.
	* libproc/common/Psymtab.c (Pupdate_maps): Use fclose instead of close
	to close the file.

2010-12-03  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/sys/procfs.h: Comment the definition of prxmap_t and
	prxmap32_t. They are not be used.
	* libproc/common/Pcontrol.c (Pxcreate): Use ptrace to trace child
	process instead of using signal to control it.
	* libproc/common/Psymtab.c (Pupdate_maps): Change the way to read
	/proc/<pid>/maps, for the file size is zero at Linux.
	* libproc/common/Psymtab.c (Preadauxvec): Change the way to read
	/proc/<pid>/auxv, for the file size is zero at Linux.

	* libproc/common/Pscantext.c (Pscantext): Change the way to read
	/proc/<pid>/maps.

2010-11-24  Shujing Zhao  <pearly.zhao@oracle.com>

	* libproc/common/Pcontrol.c (sig_int): New function used as signal
	handler.
	(Pxcreate): Add signal handler to child process. Use
	/proc/<pid>/mem instead of /proc/<pid>/as, </proc/<pid>/stat instead
	of /proc/<pid>/status and remove to use /proc/<pid>/ctl. Use waitpid
	on the parent process.
	(Pgrab, Preopen, Pstopstatus): Similar with the Pxcreat. Fix the proc
	files and don't use ctl to control the process.

2010-11-16  Shujing Zhao  <pearly.zhao@oracle.com>
	
	* libdtrace/makefile (dt_lex.c): Use "-l" compatibility option to write
	  to the .c file.
	* libdtrace/dt_impl.h: Remove the declaration of yytext for Linux.
	* libdtrace/dt_lex.l: Undefine input() and unput() and define YY_INPUT()
	  macro.

2010-11-05  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/makefile (dt_errtags.c, dt_names.c): Use sh to run the
	script.

2010-11-04  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/types_various.h (SYS_getpeername, SYS_getsockname and
	SYS_getsockopt): New.
	* include/sys/old_procfs.h: Make old_procfs.h can be included even
	_LP64 is not defined.
	* libdtrace/dt_module.c: Use elf_getshstrndx instead of
	elf_getshdrstrndx.
	* libport/elf.c: Removed.
	* libport/makefile: Remove elf.o and fix the compile option.
	* libproc/common/Psymtab.c: Use elf_getshstrndx and elf_getshnum
	instead of elf_getshdrstrndx and elf_getshdrnum.

2010-11-03  Shujing Zhao  <pearly.zhao@oracle.com>

	* common/ctf/ctf_create.c: Include types_various.h.
	
	include/
	* ieeefp.h: New.
	* sys/fp.h: New.
	* sys/procfs.h: New.
	* sys/signal2.h: New.
	* sys/types32.h: New.
	* procfs.h: Remove _STRUCTURED_PROC definition.
	* types_posix.h: New type major_t and minor_t.
	* types_time.h: New struct itimerval32.
	* procfs_service.h: Move psaddr_t and lwpid_t to ...
	* types_various.h: ... here.
	(dev32_t, size32_t and caddr32_t): Removed.
	(ino64_t): Define if ino64_t not defined.
	(blkcnt64_t and blksize_t): New type.
	(SYS_sigaction and SYS_fstatat64): New.
	(SYS_getpeername, SYS_getsockname and SYS_getsockopt): Removed.
	(flock64_32_t): New.
	(SI_FROMUSER, SI_FROMKERNEL and SI_CANQUEUE): New.
	* sys/auxv.h: Remove _ASM and _SYSCALL32 conditional.
	* sys/link.h: Likewise. 
	* sys/old_procfs.h: Likewise.
	* sys/procfs_isa.h: Likewise.
	* sys/regset.h: Likewise.
	* sys/stat.h: Likewise.
	* sys/statvfs.h: New type statvfs32_t.

	libdtrace/
	* dt_aggregate.c: Include sys/procfs.h.
	* dt_module.c: Include sys/stat.h.
	* makefile (dt_module.o): Use -D_LARGEFILE64_SOURCE=1 option.

	libproc/common/
	* P32ton.c (sigaction_32_to_n, sigaction_n_to_32): Use sa_handler32.
	(siginfo_32_to_n, siginfo_n_to32): Remove the lines of asign to the
	members that don't exist on Linux.
	(prfpregset_32_to_n, prfpregset_n_to_32): Comment the part of amd64.
	* P32ton.h: Fix the inclusions.
	* Pcore.c (core_find_text, core_find_data): Convert the type.
	* Psyscall.c: Include sys/stack.h.
	* makefile: Add compile option -I../../uts/intel/
	(Pcore.o): Add -D_LARGEFILE64_SOURCE=1 option.
	* pr_getitimer.c: Include types_time.h.
	* pr_stat.c: Remove the lines of st_fstype.
	* pr_statvfs.c: Remove the lines of f_basetype and f_fstr.
	
	libport/
	* elf.c: New
	* makefile: Update.

	librtld/
	* rtld.h: Remove _SYSCALL32 conditional.
	* rtld_db.c: Define _rd_reset64.

	uts/common/
	* sys/ctf_api.h: Include sys/procfs.h.
	* sys/procfs.h: Removed.
	* intel/sys/stack.h: New.
	* intel/ia32/sys/stack.h: New.

2010-10-26  Shujing Zhao  <pearly.zhao@oracle.com>
	
	* libdtrace/makefile: Fix dt_isadep.o, dt_module.o.
	* libdtrace/dt_module.c: Include sys/stat.h.

2010-10-25  Paolo Carlini  <paolo.carlini@oracle.com>

	* libdtrace/drti.c (dprintf): Remove.

2010-10-25  Shujing Zhao  <pearly.zhao@oracle.com>

	* libdtrace/dt_grammar.c: Remove generated file.
	* libdtrace/makefile: Fix BUILD_DIR.
	* libport/makefile: Same.
	* libproc/common/makefile: Same.

2010-10-22  Shujing Zhao  <pearly.zhao@oracle.com>

	* cmd/dtrace.c: Remove.
	* uts/common/sys/elftypes.h: Remove.
	* include/sys/int_types.h: Remove int_fast16_t etc.
	* include/sys/regset.h: Remove gregset_t delaration.

2010-10-21  Shujing Zhao  <pearly.zhao@oracle.com>

	* demo/act/time.d: New.
	* makefile: New.
	* libproc/common/makefile: Fix BUILD_DIR.
	* cmd/common/makefile: Same.
	* libctf/makefile: Same.
	* libdtrace/makefile: Same.
	* libport/makefile: Same.
	* librtld/makefile: Same.

2010-10-15  Shujing Zhao  <pearly.zhao@oracle.com>

	* librtld/rtld_db.c: Comment some functions.
	* cmd/common/makefile: New.
	* include/mutex.h: Declare mutex_init.
	* include/procs_service.h: include elf.h.
	* include/rtld_db.h: Update declaration.
	* include/type_posix.h: Define off64_t.
	* libdtrace/dt_cc.c: Define yylineno.
	* libdtrace/dt_lex.l: Define unput.
	* libdtrace/makefile: Fix compile option.
	* libport/proc_name.c: Define fork1.
	* libport/time.c: Define pthread_cond_reltimedwait_np, mutex_init and
	_lwp_kill.
	* libproc/common/makefile: Fix.
	* libproc/common/Pcontrol.c, libproc/common/Pexecname.c,
	libproc/common/Pzone.c: Comment some lines that are not supported by
	Linux.

2010-09-27  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/rtld_db.h, include/types_off.h: Adjust definition.
	* libctf/makefile: Use /usr/bin/gcc.
	* libport/makefile, libport/p_online.c, libport/tasksys.c: New.
	* libproc/common/makefile: Use -D_LARGEFILE64_SOURCE=1 to make the
	off64_t available.
	* libproc/common/Pzone.c: Comment some functions not be compiled.
	* librtld/rd_elf.c: New.
	* librtld/makefile: Add rd_elf.o to LIB.
	* librtld/rtld_db.c (rd_loadobj_iter, rd_event_addr, rd_event_enable,
	rd_event_getmsg): Change.
	(rd_plt_resolution, rd_objpad_enable): Remove.

2010-09-21  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/objfs.h: Move to uts/common/sys/.
	* libdtrace/makefile: Export correct format to dt_errtags.c.
	* libdtrace/dt_impl.h, dt_open.c, dt_parser.c, dt_dof.c: Fixed include
	header files.
	* librtld/makefile: Fix the compile options.
	* include/types_various.h: Add ABS macro and and move OBJFS_ROOT to
	objfs.h.

2010-09-19  Shujing Zhao  <pearly.zhao@oracle.com>

	* driver/dis_tables.h: Include sys/int_types.h.
	* driver/dis_tables.c: Added.
	* libdtrace/mknames.sh: Use awk. 
	* libdtrace/makefile: Include dis_tables.o, dt_errtags.o and
	dt_names.o.

2010-09-17  Shujing Zhao  <pearly.zhao@oracle.com>

	* libport/gmatch.c: Added.
	* librtld/makefile, libctf/makefile: Added.
	* include/types_various.h, include/types_off.h: Update.

2010-09-16  Shujing Zhao  <pearly.zhao@oracle.com>

	* include/mutex.h, libdtrace, libproc, librtld: Fix the mutex
	problems.
	* libport/proc_name.c, libport/strlcat.c: Added.
	* include/port.h, uts/common/sys/mnttab.h, include/sys/bitmap.h,
	include/sys/elftypes.h: Added.

2010-09-13  Shujing Zhao  <pearly.zhao@oracle.com>

	* librtld: Added.
	* libdtrace (dt_lex.l, makefile): Fixed.
	* include/types_various.h: Define ino64_t and PS_OBJ_LDSO.

2010-09-10  Shujing Zhao  <pearly.zhao@oracle.com>

	* libport: Add compat functions support at libport.
	* libdtrace/makefile: Handle the dt_lex.l and add it to the lib.
	* libdtrace/dt_impl.h: Define different yytext at Linux.

2010-09-08  Shujing Zhao  <pearly.zhao@oracle.com>

	* Define __USE_ATFILE before include <fcntl.h> when use AT_*
	constants.
	* Add makefile for libproc and libdtrace.
	* Adjust the header files.

2010-09-07  Shujing Zhao  <pearly.zhao@oracle.com>

	* Adjust the header files at directory include to make the files of
	libproc	can be compiled. Move some modified headers from uts to
	include. Fix the source files at libproc.

2010-08-31  Shujing Zhao  <pearly.zhao@oracle.com>

	* Strip the Solaris header files dependency from the sources files.
	Add the fix includes at the directory include. Fix the compile
	options.
